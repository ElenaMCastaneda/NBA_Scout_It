<!DOCTYPE html>
<html lang="en">

<head>
	<title>NBA Scout It</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	
	<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">


	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
	<script src="//d3js.org/d3.v3.min.js"></script>
</head>	


<body >
	{% extends "template.html" %}
    {% block content %}
	<div class="jumbotron" style="background-image: url(../static/images/basketball.jpg);">		
		<a class="btn btn-primary btn-lg" href="{{ url_for('home') }}" role="button">Scout Another Opponent</a>
	</div>

	<link rel="stylesheet" href="style.css">


	<div id="chart"> </div>
	
	<script>
	
	  histogramData = [];
	  $(function() {
		var globalData = {
		  "resource": "shotchartdetail",
		  "parameters": {
			"LeagueID": "00",
			"Season": "2015-16",
			"SeasonType": "Regular Season",
			"TeamID": 0,
			"PlayerID": 201952,
			"GameID": null,
			"Outcome": null,
			"Location": null,
			"Month": 0,
			"SeasonSegment": null,
			"DateFrom": null,
			"DateTo": null,
			"OpponentTeamID": 0,
			"VsConference": null,
			"VsDivision": null,
			"Position": null,
			"RookieYear": null,
			"GameSegment": null,
			"Period": 0,
			"LastNGames": 0,
			"ClutchTime": null,
			"AheadBehind": null,
			"PointDiff": null,
			"RangeType": null,
			"StartPeriod": null,
			"EndPeriod": null,
			"StartRange": null,
			"EndRange": null,
			"ContextFilter": "SEASON_YEAR='2015-16'",
			"ContextMeasure": "FGA"
		  },

 
		  "resultSets": [{
          "name": "Shot_Chart_Detail",
          "headers": ["GRID_TYPE", "GAME_ID", "GAME_EVENT_ID", "PLAYER_ID", "PLAYER_NAME", "TEAM_ID", "TEAM_NAME", "PERIOD", "MINUTES_REMAINING", "SECONDS_REMAINING", "EVENT_TYPE", "ACTION_TYPE", "SHOT_TYPE", "SHOT_ZONE_BASIC", "SHOT_ZONE_AREA", "SHOT_ZONE_RANGE", "SHOT_DISTANCE", "LOC_X", "LOC_Y", "SHOT_ATTEMPTED_FLAG", "SHOT_MADE_FLAG"],
          "rowSet": [
            ["Shot Chart Detail", "0021500001", 20, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 1, 9, 29, "Missed Shot", "Pullup Jump shot", "2PT Field Goal", "Mid-Range", "Center(C)", "8-16 ft.", 15, -2, 154, 1, 0],
            ["Shot Chart Detail", "0021500001", 23, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 1, 9, 12, "Missed Shot", "Driving Layup Shot", "2PT Field Goal", "Restricted Area", "Center(C)", "Less Than 8 ft.", 1, 12, 2, 1, 0],
            ["Shot Chart Detail", "0021500001", 32, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 1, 8, 34, "Made Shot", "Running Layup Shot", "2PT Field Goal", "Restricted Area", "Center(C)", "Less Than 8 ft.", 1, 15, -1, 1, 1],
            ["Shot Chart Detail", "0021500001", 60, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 1, 5, 37, "Missed Shot", "Fadeaway Jump Shot", "2PT Field Goal", "Mid-Range", "Left Side(L)", "8-16 ft.", 13, -132, 11, 1, 0],
            ["Shot Chart Detail", "0021500001", 171, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 2, 7, 23, "Made Shot", "Pullup Jump shot", "2PT Field Goal", "Mid-Range", "Right Side Center(RC)", "16-24 ft.", 16, 101, 129, 1, 1],
            ["Shot Chart Detail", "0021500001", 174, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 2, 6, 50, "Made Shot", "Driving Layup Shot", "2PT Field Goal", "Restricted Area", "Center(C)", "Less Than 8 ft.", 0, -1, -1, 1, 1],
            ["Shot Chart Detail", "0021500001", 180, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 2, 6, 5, "Made Shot", "Running Layup Shot", "2PT Field Goal", "Restricted Area", "Center(C)", "Less Than 8 ft.", 1, 17, -1, 1, 1],
            ["Shot Chart Detail", "0021500001", 207, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 2, 3, 38, "Missed Shot", "Cutting Layup Shot", "2PT Field Goal", "Restricted Area", "Center(C)", "Less Than 8 ft.", 0, -7, -5, 1, 0],
            ["Shot Chart Detail", "0021500001", 215, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 2, 2, 40, "Made Shot", "Pullup Jump shot", "2PT Field Goal", "Mid-Range", "Left Side Center(LC)", "16-24 ft.", 18, -145, 121, 1, 1],
            ["Shot Chart Detail", "0021500001", 230, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 2, 0, 59, "Missed Shot", "Driving Layup Shot", "2PT Field Goal", "Restricted Area", "Center(C)", "Less Than 8 ft.", 1, -17, -1, 1, 0],
            ["Shot Chart Detail", "0021500001", 233, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 2, 0, 36, "Missed Shot", "Jump Shot", "3PT Field Goal", "Above the Break 3", "Left Side Center(LC)", "24+ ft.", 24, -89, 228, 1, 0],
            ["Shot Chart Detail", "0021500001", 244, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 3, 11, 27, "Missed Shot", "Pullup Jump shot", "2PT Field Goal", "Mid-Range", "Left Side(L)", "16-24 ft.", 16, -163, -6, 1, 0],
            ["Shot Chart Detail", "0021500001", 265, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 3, 9, 17, "Missed Shot", "Jump Shot", "3PT Field Goal", "Above the Break 3", "Left Side Center(LC)", "24+ ft.", 25, -205, 149, 1, 0],
            ["Shot Chart Detail", "0021500001", 515, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 4, 0, 38, "Made Shot", "Running Layup Shot", "2PT Field Goal", "Restricted Area", "Center(C)", "Less Than 8 ft.", 1, 12, -6, 1, 1],
            ["Shot Chart Detail", "0021500001", 523, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 4, 0, 29, "Made Shot", "Pullup Jump shot", "3PT Field Goal", "Above the Break 3", "Center(C)", "24+ ft.", 25, -65, 244, 1, 1],
            ["Shot Chart Detail", "0021500001", 530, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 4, 0, 23, "Missed Shot", "Running Layup Shot", "2PT Field Goal", "Restricted Area", "Center(C)", "Less Than 8 ft.", 2, 20, -1, 1, 0],
            ["Shot Chart Detail", "0021500019", 15, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 1, 10, 34, "Missed Shot", "Jump Shot", "2PT Field Goal", "Mid-Range", "Left Side(L)", "16-24 ft.", 18, -168, 70, 1, 0],
            ["Shot Chart Detail", "0021500019", 45, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 1, 6, 57, "Missed Shot", "Jump Shot", "3PT Field Goal", "Above the Break 3", "Right Side Center(RC)", "24+ ft.", 24, 194, 151, 1, 0],
            ["Shot Chart Detail", "0021500019", 67, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 1, 5, 14, "Missed Shot", "Jump Shot", "2PT Field Goal", "Mid-Range", "Left Side Center(LC)", "16-24 ft.", 20, -150, 139, 1, 0],
            ["Shot Chart Detail", "0021500019", 70, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 1, 4, 48, "Missed Shot", "Jump Shot", "3PT Field Goal", "Left Corner 3", "Left Side(L)", "24+ ft.", 24, -243, -31, 1, 0],
			["Shot Chart Detail", "0021501221", 73, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 1, 4, 43, "Missed Shot", "Driving Layup Shot", "2PT Field Goal", "Restricted Area", "Center(C)", "Less Than 8 ft.", 0, -4, 3, 1, 0],
            ["Shot Chart Detail", "0021501221", 199, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 2, 7, 38, "Missed Shot", "Jump Shot", "3PT Field Goal", "Above the Break 3", "Center(C)", "24+ ft.", 25, 66, 247, 1, 0],
            ["Shot Chart Detail", "0021501221", 241, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 2, 5, 2, "Made Shot", "Finger Roll Layup Shot", "2PT Field Goal", "Restricted Area", "Center(C)", "Less Than 8 ft.", 1, 2, -16, 1, 1],
            ["Shot Chart Detail", "0021501221", 243, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 2, 4, 36, "Missed Shot", "Layup Shot", "2PT Field Goal", "Restricted Area", "Center(C)", "Less Than 8 ft.", 1, -11, -6, 1, 0],
            ["Shot Chart Detail", "0021501221", 261, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 2, 3, 26, "Made Shot", "Floating Jump shot", "2PT Field Goal", "In The Paint (Non-RA)", "Center(C)", "Less Than 8 ft.", 7, 25, 70, 1, 1],
            ["Shot Chart Detail", "0021501221", 327, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 3, 10, 47, "Made Shot", "Layup Shot", "2PT Field Goal", "Restricted Area", "Center(C)", "Less Than 8 ft.", 0, -2, 0, 1, 1],
            ["Shot Chart Detail", "0021501221", 384, 201952, "Jeff Teague", 1610612737, "Atlanta Hawks", 3, 5, 58, "Missed Shot", "Jump Shot", "3PT Field Goal", "Above the Break 3", "Center(C)", "24+ ft.", 25, -73, 247, 1, 0]
          ]
        }, {
          "name": "LeagueAverages",
          "headers": ["GRID_TYPE", "SHOT_ZONE_BASIC", "SHOT_ZONE_AREA", "SHOT_ZONE_RANGE", "FGA", "FGM", "FG_PCT"],
          "rowSet": [
            ["League Averages", "Above the Break 3", "Back Court(BC)", "Back Court Shot", 59, 4, 0.068],
            ["League Averages", "Above the Break 3", "Center(C)", "24+ ft.", 10884, 3746, 0.344],
            ["League Averages", "Above the Break 3", "Left Side Center(LC)", "24+ ft.", 16648, 5802, 0.349],
            ["League Averages", "Above the Break 3", "Right Side Center(RC)", "24+ ft.", 15837, 5597, 0.353],
            ["League Averages", "Backcourt", "Back Court(BC)", "Back Court Shot", 440, 17, 0.039],
            ["League Averages", "In The Paint (Non-RA)", "Center(C)", "8-16 ft.", 6851, 2889, 0.422],
            ["League Averages", "In The Paint (Non-RA)", "Center(C)", "Less Than 8 ft.", 19352, 7561, 0.391],
            ["League Averages", "In The Paint (Non-RA)", "Left Side(L)", "8-16 ft.", 2089, 842, 0.403],
            ["League Averages", "In The Paint (Non-RA)", "Right Side(R)", "8-16 ft.", 1932, 799, 0.414],
            ["League Averages", "Left Corner 3", "Left Side(L)", "24+ ft.", 7865, 2940, 0.374],
            ["League Averages", "Mid-Range", "Center(C)", "16-24 ft.", 7324, 2897, 0.396],
            ["League Averages", "Mid-Range", "Center(C)", "8-16 ft.", 2265, 987, 0.436],
            ["League Averages", "Mid-Range", "Left Side Center(LC)", "16-24 ft.", 7754, 3066, 0.395],
            ["League Averages", "Mid-Range", "Left Side(L)", "16-24 ft.", 5452, 2173, 0.399],
            ["League Averages", "Mid-Range", "Left Side(L)", "8-16 ft.", 7639, 3005, 0.393],
            ["League Averages", "Mid-Range", "Right Side Center(RC)", "16-24 ft.", 8145, 3249, 0.399],
            ["League Averages", "Mid-Range", "Right Side(R)", "16-24 ft.", 4924, 1996, 0.405],
            ["League Averages", "Mid-Range", "Right Side(R)", "8-16 ft.", 7630, 3011, 0.395],
            ["League Averages", "Restricted Area", "Center(C)", "Less Than 8 ft.", 67444, 40634, 0.602],
            ["League Averages", "Right Corner 3", "Right Side(R)", "24+ ft.", 7361, 2803, 0.381]
          ]
        }]
      };
      histogramData = [];
      function loadVisual(playerData) {
        var margins = {
            left: 10,
            right: 100,
            top: 100,
            bottom: 10
          },
          max_x = 500,
          max_y = (max_x * 0.8333333333333334),
          max = {
            x: max_x,
            y: max_y
          }
        var svg = d3.select("#chart").html("");
        r_svg = d3.select("#chart").append("svg:svg")
          .attr("width", max.x + margins.left + margins.right)
          .attr("height", max.y + margins.left + margins.right)
          .attr("background-color", "#122737");
        var svg = r_svg.append("g")
          .attr("transform", "translate(" + margins.left + "," + margins.top + ")")
          .attr("id", "shotchart");
        var courtUrl = "nbahalfcourt.png";
        svg.append("svg:defs")
          .append("svg:pattern")
          .attr("id", "bg")
          .attr('patternUnits', 'userSpaceOnUse')
          .attr("width", max.x)
          .attr("height", max.y)
          .append("svg:image")
          .attr("id", "image-url")
          .attr("xlink:href", courtUrl)
          .attr("width", max.x)
          .attr("height", max.y);
        svg.append("rect")
          .attr("x", "0")
          .attr("y", "0")
          .attr("width", max.x)
          .attr("height", max.y)
          .attr("fill", "url(#bg)");
        playerData = playerData['resultSets'][0]['rowSet'];
        //console.log(playerData);
        //found correct range by hand..varies with svg
        var xScale = d3.scale.linear()
          .domain([-285, 285])
          //.range([42, 738]);
          .range([0, max.x]);
        var yScale = d3.scale.linear()
          .domain([-1, 0, -150])
          .range([max.y * 0.9076923076923077, max.y * 0.9061538461538462, max.y * 0.5707692307692308]);
        var colorValue = function(d) {
          if (d[10] === "Missed Shot") {
            return "#e61212";
          }
          if (d[10] === "Made Shot") {
            return "#6ae916";
          }
        }
        var xValue = function(d) {
          return xScale(-d[17]);
        }
        var yValue = function(d) {
          return (d[16] > 45 ? 0 : yScale(-d[18]));
        }
        var classByShot = function(d) {
          if (d[10] === "Missed Shot") {
            return "dot missed";
          }
          if (d[10] === "Made Shot") {
            return "dot made";
          }
        }
        d3.selectAll('dot').remove();
        var node = svg.selectAll("dot").data(playerData)
        node.enter()
          .append("svg:circle")
          .attr("r", 4)
          .attr("cx", function(d) {
            return xValue(d);
          })
          .attr("cy", function(d) {
            return yValue(d);
          })
          .attr("class", function(d) {
            return classByShot(d);
          })
          .style("fill", function(d) {
            return colorValue(d);
          });
        /* Building histogram data */
        for (var k = 0; k < playerData.length; k++) {
          var cord = [];
          cord.push(xValue(playerData[k]));
          cord.push(yValue(playerData[k]));
          histogramData.push(cord);
        }
        // top histogram
        var gTop = r_svg.append("g")
          .attr("transform",
            "translate(" + margins.left + "," + 0 + ")");
        var m = d3.max(histogramData, function(d) { return d[0] });
        var xBins = d3.layout.histogram()
          .range([0,m])
          .bins(d3.range(0, m + 20, 20))
          .value(function(d) {
            return d[0];
          })(histogramData);
          
        var xy = d3.scale.linear()
          .domain([0, d3.max(xBins, function(d) {
            return d.length;
          })])
          .range([margins.top, 0]);
        var xBar = gTop.selectAll(".bar")
          .data(xBins)
          .enter().append("g")
          .attr("class", "bar")
          .attr("transform", function(d) {
            return "translate(" + (d.x) + "," + xy(d.length) + ")";
          });
        var bWidth = xBins[0].dx - 1;
        xBar.append("rect")
          .attr("x", 1)
          .attr("width", bWidth)
          .attr("height", function(d) {
            return margins.top - xy(d.length);
          })
          .style("fill", "steelblue");
        xBar.append("text")
          .attr("dy", ".75em")
          .attr("y", 2)
          .attr("x", bWidth / 2)
          .attr("text-anchor", "middle")
          .text(function(d) {
            return d.length < 15 ? "" : d.length;
          })
          .style("fill", "white")
          .style("font", "9px sans-serif");
        // right histogram
        var gRight = r_svg.append("g")
          .attr("transform",
            "translate(" + (margins.left + max.x) + "," + margins.top + ")");
        var m = d3.max(histogramData, function(d) { return d[1] });
        var yBins = d3.layout.histogram()
          .range([0, m])
          .bins(d3.range(0, m + 20, 20))
          .value(function(d) {
            return d[1];
          })(histogramData);
        var yx = d3.scale.linear()
          .domain([0, d3.max(yBins, function(d) {
            return d.length;
          })])
          .range([0, margins.right]);
        var yBar = gRight.selectAll(".bar")
          .data(yBins)
          .enter().append("g")
          .attr("class", "bar")
          .attr("transform", function(d) {
            return "translate(" + 0 + "," + (d.x) + ")";
          });
        yBar.append("rect")
          .attr("y", 1)
          .attr("width", function(d) {
            return yx(d.length);
          })
          .attr("height", bWidth)
          .style("fill", "steelblue");
        yBar.append("text")
          .attr("dx", "-.75em")
          .attr("y", bWidth / 2 + 1)
          .attr("x", function(d) {
            return yx(d.length);
          })
          .attr("text-anchor", "middle")
          .text(function(d) {
            return d.length < 15 ? "" : d.length;
          })
          .style("fill", "white")
          .style("font", "9px sans-serif");
      }
      loadVisual(globalData);
    });
  </script>
   
{% endblock %}
</body>
	
</html>